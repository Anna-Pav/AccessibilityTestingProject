"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.makeFindElement = void 0;
function makeFindElement({ req }) {
    return async function findElement({ session, request, response, logger, }) {
        var _a, _b, _c;
        logger.log('Inspecting element lookup request to collect self-healing metadata');
        const proxyResponse = await req(request.url, { io: { request, response, handle: false }, logger });
        const responseBody = await proxyResponse.json();
        if ((_b = (_a = responseBody === null || responseBody === void 0 ? void 0 : responseBody.appliCustomData) === null || _a === void 0 ? void 0 : _a.selfHealing) === null || _b === void 0 ? void 0 : _b.successfulSelector) {
            logger.log('Self-healed locators detected', responseBody.appliCustomData.selfHealing);
            (_c = session.metadata) !== null && _c !== void 0 ? _c : (session.metadata = []);
            session.metadata.push(responseBody.appliCustomData.selfHealing);
        }
        else {
            logger.log('No self-healing metadata found');
        }
        response
            .writeHead(proxyResponse.status, Object.fromEntries(proxyResponse.headers.entries()))
            .end(JSON.stringify(responseBody));
    };
}
exports.makeFindElement = makeFindElement;
